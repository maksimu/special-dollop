# guacr-rdp

RDP protocol handler for guacr using FreeRDP.

## Overview

This crate provides Windows Remote Desktop Protocol (RDP) support for guacr using 
FreeRDP, the same mature C library used by Apache Guacamole's guacd daemon.

## System Requirements

FreeRDP 3.x development libraries must be installed on your system:

### Ubuntu/Debian

```bash
apt install freerdp3-dev libwinpr3-dev
```

### Fedora/RHEL

```bash
dnf install freerdp-devel
```

### macOS

```bash
brew install freerdp
```

## Features

- Full RDP protocol support (same as guacd)
- Network Level Authentication (NLA)
- TLS and legacy RDP security
- Clipboard synchronization
- Audio playback (rdpsnd)
- Drive redirection
- Printer redirection
- Display resize
- RemoteApp support
- RDP Gateway support

## Usage

```rust
use guacr_rdp::RdpHandler;
use guacr_handlers::ProtocolHandler;
use std::collections::HashMap;

let handler = RdpHandler::with_defaults();

let mut params = HashMap::new();
params.insert("hostname".to_string(), "windows-server.example.com".to_string());
params.insert("username".to_string(), "Administrator".to_string());
params.insert("password".to_string(), "password123".to_string());
params.insert("security".to_string(), "nla".to_string());

// handler.connect(params, to_client, from_client).await?;
```

## Connection Parameters

### Required

| Parameter | Description |
|-----------|-------------|
| `hostname` | RDP server hostname or IP address |
| `username` | Username for authentication |
| `password` | Password for authentication |

### Optional

| Parameter | Default | Description |
|-----------|---------|-------------|
| `port` | 3389 | RDP port |
| `domain` | (none) | Windows domain |
| `width` | 1024 | Display width in pixels |
| `height` | 768 | Display height in pixels |
| `dpi` | 96 | Display DPI |
| `color-depth` | 32 | Color depth (16, 24, or 32) |
| `security` | nla | Security mode: any, nla, tls, rdp |
| `ignore-cert` | false | Ignore certificate errors |
| `disable-audio` | false | Disable audio playback |
| `enable-printing` | false | Enable printer redirection |
| `enable-drive` | false | Enable drive redirection |
| `drive-path` | (none) | Path for drive redirection |
| `disable-copy` | false | Disable clipboard copy |
| `disable-paste` | false | Disable clipboard paste |
| `resize-method` | none | Resize handling: none, reconnect, display-update |

### RemoteApp

| Parameter | Description |
|-----------|-------------|
| `remote-app` | RemoteApp program path |
| `remote-app-dir` | RemoteApp working directory |
| `remote-app-args` | RemoteApp arguments |

### Gateway

| Parameter | Description |
|-----------|-------------|
| `gateway-hostname` | RD Gateway hostname |
| `gateway-port` | RD Gateway port |
| `gateway-username` | Gateway username |
| `gateway-password` | Gateway password |
| `gateway-domain` | Gateway domain |

## Architecture

```
guacr-rdp/
├── src/
│   ├── lib.rs           # Public API
│   ├── ffi/             # FreeRDP FFI bindings (generated by bindgen)
│   │   ├── mod.rs
│   │   └── wrapper.h
│   ├── client.rs        # FreeRDP client wrapper
│   ├── handler.rs       # ProtocolHandler implementation
│   ├── settings.rs      # Connection settings parser
│   ├── channels/        # RDP channel handlers
│   │   ├── mod.rs
│   │   └── clipboard.rs
│   └── error.rs         # Error types
├── build.rs             # bindgen build script
└── Cargo.toml
```

## Why FreeRDP?

This crate uses FreeRDP instead of a pure Rust implementation (like IronRDP) because:

1. **Maturity**: FreeRDP has 15+ years of development and is battle-tested
2. **Compatibility**: Same library guacd uses, ensuring protocol compatibility
3. **Features**: Complete RDP implementation including all channels
4. **Stability**: Stable API with infrequent breaking changes

The tradeoff is requiring FFI bindings and system library dependencies, but this
is outweighed by the reliability benefits for production use.

## License

MIT
